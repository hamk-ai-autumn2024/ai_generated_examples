<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BMI & Health Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg-start: 255, 255, 255;
      --bg-end: 240, 246, 255;
      --card-bg: 255, 255, 255;
      --text: 17, 24, 39;
      --muted: 100, 116, 139;
      --brand: 59, 130, 246;
      --ok: 16, 185, 129;
      --warn: 245, 158, 11;
      --bad: 239, 68, 68;
      --ring: 147, 197, 253;
      --shadow: 15, 23, 42;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg-start: 2, 6, 23;
        --bg-end: 15, 23, 42;
        --card-bg: 17, 24, 39;
        --text: 226, 232, 240;
        --muted: 148, 163, 184;
        --brand: 96, 165, 250;
        --ring: 59, 130, 246;
        --shadow: 0, 0, 0;
      }
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      color: rgb(var(--text));
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(var(--brand),0.12), rgba(var(--bg-start),0) 60%),
        radial-gradient(900px 500px at 110% 10%, rgba(99,102,241,0.10), rgba(var(--bg-end),0) 55%),
        linear-gradient(180deg, rgb(var(--bg-start)) 0%, rgb(var(--bg-end)) 100%);
    }
    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:clamp(16px, 3vw, 32px);
    }
    .card{
      width: min(760px, 100%);
      background: rgba(var(--card-bg), 0.9);
      backdrop-filter: saturate(1.2) blur(10px);
      border: 1px solid rgba(148,163,184,.15);
      border-radius: 18px;
      padding: clamp(20px, 3.5vw, 34px);
      box-shadow: 0 30px 60px -20px rgba(var(--shadow), .35);
    }
    h1{
      margin:0 0 6px;
      font-size: clamp(22px, 3.8vw, 34px);
      line-height:1.15;
      letter-spacing: -.02em;
    }
    .sub{
      margin:0 0 22px;
      color: rgb(var(--muted));
      font-size: clamp(13px, 2.4vw, 15px);
    }
    form{
      display:grid;
      gap: 14px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 640px){
      form{ grid-template-columns: 1fr 1fr; }
    }
    .field{
      display:flex;
      flex-direction:column;
      gap: 6px;
      position: relative;
    }
    label{
      font-weight: 600;
      font-size: 0.95rem;
    }
    .input-wrap{
      position: relative;
      display:flex;
      align-items:center;
    }
    input[type="text"]{
      width:100%;
      appearance: none;
      padding: 12px 44px 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,.4);
      background: rgba(255,255,255,.7);
      color: inherit;
      outline: none;
      font-size: 1rem;
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    @media (prefers-color-scheme: dark){
      input[type="text"]{ background: rgba(2,6,23,.35) }
    }
    input[type="text"]:focus{
      border-color: rgb(var(--brand));
      box-shadow: 0 0 0 4px rgba(var(--ring), .25);
    }
    .unit{
      position:absolute;
      right: 10px;
      font-size: .95rem;
      color: rgb(var(--muted));
      pointer-events:none;
    }
    .error{
      min-height: 1.1em;
      font-size: 0.85rem;
      color: rgb(var(--bad));
    }
    .actions{
      grid-column: 1 / -1;
      display:flex;
      gap: 10px;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    button{
      appearance: none;
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: transform .04s ease, box-shadow .15s ease, background .15s ease;
    }
    .btn-primary{
      background: linear-gradient(180deg, rgba(var(--brand),.95), rgba(var(--brand),.85));
      color: white;
      box-shadow: 0 10px 22px -10px rgba(59,130,246,.6);
    }
    .btn-secondary{
      background: rgba(148,163,184,.16);
      color: inherit;
      border: 1px solid rgba(148,163,184,.35);
    }
    button:active { transform: translateY(1px) }
    .result{
      grid-column: 1 / -1;
      margin-top: 16px;
      display:none;
      border-top: 1px dashed rgba(148,163,184,.4);
      padding-top: 16px;
    }
    .result.visible{ display:block }
    .kpis{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media (min-width: 640px){
      .kpis{ grid-template-columns: 1.2fr 1fr }
    }
    .panel{
      border: 1px solid rgba(148,163,184,.35);
      border-radius: 14px;
      padding: 14px;
      background: rgba(255,255,255,.6);
    }
    @media (prefers-color-scheme: dark){
      .panel{ background: rgba(2,6,23,.35) }
    }
    .bmi-value{
      font-size: clamp(24px, 6vw, 40px);
      font-weight: 800;
      letter-spacing: -.02em;
      margin: 2px 0 6px;
    }
    .badge{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: .85rem;
      font-weight: 700;
      border: 1px solid transparent;
    }
    .is-normal{ background: rgba(var(--ok), .15); color: rgb(var(--ok)); border-color: rgba(var(--ok), .35) }
    .is-over{ background: rgba(var(--warn), .15); color: rgb(var(--warn)); border-color: rgba(var(--warn), .35) }
    .is-obese{ background: rgba(var(--bad), .15); color: rgb(var(--bad)); border-color: rgba(var(--bad), .35) }
    .is-under{ background: rgba(99,102,241,.15); color: rgb(99,102,241); border-color: rgba(99,102,241,.35) }

    .meter-wrap{
      margin-top: 8px;
    }
    meter{
      width: 100%;
      height: 18px;
    }
    .legend{
      display:flex; justify-content:space-between; gap:8px;
      font-size: .8rem; color: rgb(var(--muted));
      margin-top:6px;
    }
    .tips h3{
      margin: 0 0 6px;
      font-size: 1.05rem;
    }
    .tips ul{ margin: 6px 0 0 18px; line-height: 1.45 }
    .muted{ color: rgb(var(--muted)) }
    .target{
      font-weight: 600;
      margin-top: 6px;
    }
    .sr-only{
      position:absolute !important;
      height:1px; width:1px; overflow:hidden;
      clip: rect(1px,1px,1px,1px);
      white-space:nowrap; border:0; padding:0; margin:-1px;
    }
    .footer{
      margin-top: 16px;
      font-size: .85rem;
      color: rgb(var(--muted));
    }
  </style>
</head>
<body>
  <noscript>
    <div style="padding:12px; background:#fee2e2; color:#991b1b; text-align:center">
      This app needs JavaScript enabled.
    </div>
  </noscript>

  <div class="wrap">
    <main class="card" role="main" aria-labelledby="app-title">
      <h1 id="app-title">BMI & Health Coach</h1>
      <p class="sub">Enter height and weight to compute your Body Mass Index (BMI), classification, and a practical target-weight range. Inline errors ensure clean data — no pop-ups.</p>

      <form id="bmi-form" novalidate>
        <!-- Height -->
        <div class="field">
          <label for="height">Height</label>
          <div class="input-wrap">
            <input
              id="height"
              name="height"
              type="text"
              inputmode="decimal"
              autocomplete="off"
              placeholder="e.g. 175 or 1.75"
              aria-describedby="height-help height-error"
              required
              pattern="^\s*\d{1,3}([.,]\d{1,3})?\s*$"
            />
            <span class="unit">cm</span>
          </div>
          <div class="muted" id="height-help">Accepts centimeters (e.g., 175). If you type meters (e.g., 1.75), we’ll interpret it correctly.</div>
          <div class="error" id="height-error" role="alert" aria-live="polite"></div>
        </div>

        <!-- Weight -->
        <div class="field">
          <label for="weight">Weight</label>
          <div class="input-wrap">
            <input
              id="weight"
              name="weight"
              type="text"
              inputmode="decimal"
              autocomplete="off"
              placeholder="e.g. 70.5"
              aria-describedby="weight-help weight-error"
              required
              pattern="^\s*\d{1,3}([.,]\d{1,3})?\s*$"
            />
            <span class="unit">kg</span>
          </div>
          <div class="muted" id="weight-help">Kilograms, decimals allowed (comma or dot).</div>
          <div class="error" id="weight-error" role="alert" aria-live="polite"></div>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">Calculate BMI</button>
          <button type="reset" class="btn-secondary" id="reset">Reset</button>
        </div>

        <!-- Results -->
        <section id="result" class="result" aria-live="polite">
          <div class="kpis">
            <div class="panel">
              <div class="muted">Your BMI</div>
              <div id="bmiValue" class="bmi-value">—</div>
              <span id="bmiBadge" class="badge">—</span>

              <div class="meter-wrap">
                <meter id="bmiMeter" min="10" max="50" value="0" low="18.5" high="25" optimum="22"></meter>
                <div class="legend">
                  <span>10</span><span>18.5</span><span>25</span><span>50</span>
                </div>
              </div>

              <div class="target" id="targetRange">Target weight for BMI 18.5–24.9: —</div>
              <div class="muted" id="interpret-note"></div>
            </div>

            <div class="panel tips">
              <h3 id="tips-title">Tips</h3>
              <ul id="tips-list">
                <li class="muted">Tips appear if BMI is outside the normal range (18.5–24.9).</li>
              </ul>
            </div>
          </div>

          <p class="footer">This is educational information, not medical advice. If you have a medical condition, consult a healthcare professional.</p>
        </section>
      </form>
    </main>
  </div>

  <script type="module">
    // =========================
    // Constants (no magic values)
    // =========================
    const CM_PER_M = 100;
    const BMI_DISPLAY_PRECISION = 1;
    const HEIGHT_CM_RANGE = Object.freeze({ min: 80, max: 250 });     // Plausible adult range
    const WEIGHT_KG_RANGE = Object.freeze({ min: 20, max: 350 });     // Plausible adult range
    const NORMAL_BMI = Object.freeze({ min: 18.5, max: 24.9 });

    /** BMI classification boundaries (inclusive of min, exclusive of max except last) */
    const BMI_CATEGORIES = Object.freeze([
      { id: "under",   name: "Underweight",        min: 0,     max: 18.5 },
      { id: "normal",  name: "Normal range",       min: 18.5,  max: 25   },
      { id: "over",    name: "Overweight",         min: 25,    max: 30   },
      { id: "obese1",  name: "Obesity class I",    min: 30,    max: 35   },
      { id: "obese2",  name: "Obesity class II",   min: 35,    max: 40   },
      { id: "obese3",  name: "Obesity class III",  min: 40,    max: Infinity }
    ]);

    // =========================
    // DOM references
    // =========================
    const form = document.getElementById('bmi-form');
    const heightEl = document.getElementById('height');
    const weightEl = document.getElementById('weight');
    const heightErr = document.getElementById('height-error');
    const weightErr = document.getElementById('weight-error');

    const resultSection = document.getElementById('result');
    const bmiValueEl = document.getElementById('bmiValue');
    const bmiBadgeEl = document.getElementById('bmiBadge');
    const bmiMeterEl = document.getElementById('bmiMeter');
    const targetRangeEl = document.getElementById('targetRange');
    const tipsListEl = document.getElementById('tips-list');
    const tipsTitleEl = document.getElementById('tips-title');
    const interpretNoteEl = document.getElementById('interpret-note');
    const resetBtn = document.getElementById('reset');

    // =========================
    // Utilities
    // =========================
    /** Parse a locale-friendly decimal string (commas or dots). Returns NaN if not a number. */
    function parseLocaleNumber(str){
      if (typeof str !== 'string') return NaN;
      const s = str.trim().replace(/\s+/g,'').replace(',', '.');
      if (!/^[-+]?\d*\.?\d+$/.test(s)) return NaN;
      return Number.parseFloat(s);
    }

    /** Round to fixed decimals, returns a Number (not string). */
    function roundTo(n, decimals = 0){
      const factor = 10 ** decimals;
      return Math.round((n + Number.EPSILON) * factor) / factor;
    }

    /** Interpret a height input: if < 3, assume meters; else centimeters. Returns centimeters. */
    function normalizeHeightToCm(raw){
      if (raw <= 0 || !Number.isFinite(raw)) return NaN;
      return raw < 3 ? raw * CM_PER_M : raw; // 1.75 -> 175
    }

    /** Persist inputs for a nicer UX */
    function saveInputs(cm, kg){
      try {
        localStorage.setItem('bmi.height', String(cm));
        localStorage.setItem('bmi.weight', String(kg));
      } catch {}
    }
    function loadInputs(){
      try {
        const h = localStorage.getItem('bmi.height');
        const w = localStorage.getItem('bmi.weight');
        if (h) heightEl.value = h;
        if (w) weightEl.value = w;
      } catch {}
    }

    function setError(inputEl, errorEl, msg){
      inputEl.setCustomValidity(msg || '');
      errorEl.textContent = msg || '';
    }

    function clearError(inputEl, errorEl){
      setError(inputEl, errorEl, '');
    }

    function classifyBmi(bmi){
      const cat = BMI_CATEGORIES.find(c => bmi >= c.min && bmi < c.max) ?? BMI_CATEGORIES[BMI_CATEGORIES.length - 1];
      return cat;
    }

    function badgeClassFor(catId){
      if (catId === 'normal') return 'badge is-normal';
      if (catId === 'under') return 'badge is-under';
      if (catId === 'over') return 'badge is-over';
      return 'badge is-obese';
    }

    function formatKg(n) { return `${roundTo(n, 1).toFixed(1)} kg`; }

    function computeTargetWeightRange(heightCm){
      const hM = heightCm / CM_PER_M;
      return {
        min: NORMAL_BMI.min * hM * hM,
        max: NORMAL_BMI.max * hM * hM
      };
    }

    function buildTips(catId, weightKg, heightCm){
      const hM = heightCm / CM_PER_M;
      const tips = [];
      if (catId === 'under'){
        const target = computeTargetWeightRange(heightCm);
        const gain = Math.max(0, target.min - weightKg);
        tips.push(`Aim for a modest surplus of ≈300–500 kcal/day. At that pace, expect ≈0.25–0.5 kg/week weight gain.`);
        tips.push(`Prioritize protein at 1.6–2.2 g/kg/day (${Math.round(1.6*weightKg)}–${Math.round(2.2*weightKg)} g/day).`);
        tips.push(`Strength train 2–3×/week (full-body). Progress compound lifts to support lean mass.`);
        tips.push(`Add energy-dense snacks: nuts, olive oil, full-fat dairy, oats, eggs.`);
        tips.push(`Your normal-range weight starts around ${formatKg(target.min)} (at ${roundTo(hM,2)} m).`);
      } else if (catId === 'over' || catId.startsWith('obese')) {
        const target = computeTargetWeightRange(heightCm);
        const lose = Math.max(0, weightKg - target.max);
        tips.push(`Set a deficit of ≈300–500 kcal/day. Typical loss ≈0.3–0.5 kg/week — sustainable and safer.`);
        tips.push(`Move more: 150–300 min/week moderate cardio (e.g., brisk walking/cycling), plus 2+ strength sessions.`);
        tips.push(`Protein 1.6–2.0 g/kg/day (${Math.round(1.6*weightKg)}–${Math.round(2.0*weightKg)} g/day) and ≥25–30 g per meal.`);
        tips.push(`High-fiber foods (vegetables, berries, legumes, whole grains). Keep sugary drinks and ultra-processed snacks rare.`);
        tips.push(`Sleep 7–9 h/night and keep a consistent schedule; poor sleep blunts fat loss.`);
        tips.push(`A healthy-range weight for your height is about ${formatKg(target.min)} to ${formatKg(target.max)}.`);
        if (catId !== 'over'){
          tips.push(`Consider discussing your plan with your physician, especially if you have existing conditions or medications.`);
        }
      }
      return tips;
    }

    // =========================
    // Validation & submission
    // =========================
    function validateAndParse(){
      clearError(heightEl, heightErr);
      clearError(weightEl, weightErr);

      // Basic pattern check via HTML5 for better mobile keyboards
      const hRawStr = heightEl.value;
      const wRawStr = weightEl.value;

      // Required checks (HTML5 will handle, but we replicate to supply nicer messages)
      if (!hRawStr.trim()){
        setError(heightEl, heightErr, 'Height is required.');
      }
      if (!wRawStr.trim()){
        setError(weightEl, weightErr, 'Weight is required.');
      }

      // Parse numbers accepting comma or dot
      const hParsed = parseLocaleNumber(hRawStr);
      const wParsed = parseLocaleNumber(wRawStr);

      if (Number.isNaN(hParsed)){
        setError(heightEl, heightErr, 'Enter a valid number for height (e.g., 175 or 1.75).');
      }
      if (Number.isNaN(wParsed)){
        setError(weightEl, weightErr, 'Enter a valid number for weight (e.g., 70 or 70.5).');
      }

      // Normalize height to cm (accept meters)
      const heightCm = normalizeHeightToCm(hParsed);
      const weightKg = wParsed;

      // Range checks
      if (!Number.isNaN(heightCm) && (heightCm < HEIGHT_CM_RANGE.min || heightCm > HEIGHT_CM_RANGE.max)){
        setError(heightEl, heightErr, `Height must be between ${HEIGHT_CM_RANGE.min} and ${HEIGHT_CM_RANGE.max} cm.`);
      }
      if (!Number.isNaN(weightKg) && (weightKg < WEIGHT_KG_RANGE.min || weightKg > WEIGHT_KG_RANGE.max)){
        setError(weightEl, weightErr, `Weight must be between ${WEIGHT_KG_RANGE.min} and ${WEIGHT_KG_RANGE.max} kg.`);
      }

      // Report validity to trigger native styling if needed
      const ok = form.reportValidity() && !heightEl.validationMessage && !weightEl.validationMessage;

      return ok ? { heightCm, weightKg, interpretedMeters: (hParsed < 3 && hParsed > 0) } : null;
    }

    function renderResults({ heightCm, weightKg, interpretedMeters }){
      const hM = heightCm / CM_PER_M;
      const bmi = weightKg / (hM * hM);
      const bmiRounded = roundTo(bmi, BMI_DISPLAY_PRECISION);

      const cat = classifyBmi(bmiRounded);
      const badgeClass = badgeClassFor(cat.id);

      // Update KPI panel
      bmiValueEl.textContent = bmiRounded.toFixed(BMI_DISPLAY_PRECISION);
      bmiBadgeEl.className = badgeClass;
      bmiBadgeEl.textContent = cat.name;

      // Meter
      bmiMeterEl.value = Math.max(bmiMeterEl.min, Math.min(bmiRounded, bmiMeterEl.max));

      // Target weight range
      const { min, max } = computeTargetWeightRange(heightCm);
      targetRangeEl.textContent = `Target weight for BMI 18.5–24.9: ${formatKg(min)} – ${formatKg(max)}`;

      // Interpret note (if we had to treat input as meters)
      interpretNoteEl.textContent = interpretedMeters
        ? `Interpreted height as meters (${roundTo(hM,2)} m).`
        : '';

      // Tips
      tipsListEl.innerHTML = '';
      let tips = [];
      if (cat.id !== 'normal'){
        tipsTitleEl.textContent = 'Practical tips for a healthier BMI';
        tips = buildTips(cat.id, weightKg, heightCm);
      } else {
        tipsTitleEl.textContent = 'You are in the normal BMI range';
        tips = [
          'Maintain: 150–300 min/week moderate activity and 2+ strength sessions.',
          `Protein ≈1.2–1.6 g/kg/day (${Math.round(1.2*weightKg)}–${Math.round(1.6*weightKg)} g/day) and keep a regular sleep schedule.`,
          'Recheck BMI if weight or activity changes materially.'
        ];
      }
      for (const t of tips){
        const li = document.createElement('li');
        li.textContent = t;
        tipsListEl.appendChild(li);
      }

      resultSection.classList.add('visible');
      saveInputs(roundTo(heightCm,1), roundTo(weightKg,1));
    }

    // =========================
    // Event listeners
    // =========================
    ['input','change','blur'].forEach(evt => {
      heightEl.addEventListener(evt, () => clearError(heightEl, heightErr));
      weightEl.addEventListener(evt, () => clearError(weightEl, weightErr));
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const parsed = validateAndParse();
      if (!parsed) return;
      renderResults(parsed);
    });

    resetBtn.addEventListener('click', () => {
      clearError(heightEl, heightErr);
      clearError(weightEl, weightErr);
      resultSection.classList.remove('visible');
      interpretNoteEl.textContent = '';
    });

    // Initialize
    loadInputs();
    // If both loaded, auto-calc for convenience (no background work later)
    (function autoCalcIfStored(){
      const parsed = validateAndParse();
      if (parsed) renderResults(parsed);
    })();
  </script>
</body>
</html>
